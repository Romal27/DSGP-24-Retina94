---
version: "3.1"

stories:
  - story: greet and ask about DR
    steps:
      - intent: greet
      - action: utter_greet
      - intent: ask_what_is_dr
      - action: utter_ask_what_is_dr
      - intent: vague_followup
      - action: action_handle_vague_followup

  - story: ask DR stages and follow-up
    steps:
      - intent: ask_dr_stages
      - action: utter_ask_dr_stages
      - intent: ask_about_specific_stage
      - action: utter_ask_about_specific_stage
      - intent: affirm_followup
      - action: action_handle_affirm_followup

  - story: ask diabetes prevention with follow-up
    steps:
      - intent: ask_diabetes_prevention
      - action: utter_ask_diabetes_prevention
      - intent: affirm_followup
      - action: utter_ask_diabetes_prevention_followup

  - story: ask retina symptoms with follow-up
    steps:
      - intent: ask_retina_symptoms
      - action: action_explain_symptoms
      - intent: vague_followup
      - action: action_handle_vague_followup

  - story: say goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - story: thank bot
    steps:
      - intent: thanks
      - action: utter_thanks

  - story: ask about healthy food with follow-up
    steps:
      - intent: ask_healthy_food
      - action: action_suggest_healthy_food
      - intent: affirm_followup
      - action: utter_healthy_food_followup

  - story: explain DR stage after user informs stage
    steps:
      - intent: inform_stage
      - slot_was_set:
          - dr_stage: "mild NPDR"
      - action: action_explain_dr_stage
      - intent: affirm_followup
      - action: action_handle_affirm_followup

  - story: handle vague follow-up after stage
    steps:
      - intent: inform_stage
      - slot_was_set:
          - dr_stage: "severe NPDR"
      - action: action_explain_dr_stage
      - slot_was_set:
          - last_question_context: "ask_treatment_for_stage"
      - intent: vague_followup
      - action: action_handle_vague_followup

  - story: follow-up on screening methods
    steps:
      - intent: ask_screening_methods
      - action: action_explain_screening
      - intent: affirm_followup
      - action: utter_screening_followup

  - story: handle unrecognized input
    steps:
      - intent: out_of_scope
      - action: utter_fallback

  - story: ask progression speed with follow-up
    steps:
      - intent: ask_dr_progression_speed
      - action: utter_ask_dr_progression_speed
      - intent: affirm_followup
      - action: action_handle_affirm_followup

